From 38e899b0fb94122eb3c4f244f829072073b4d567 Mon Sep 17 00:00:00 2001
From: khanh <khanhnq.23bi14215@usth.edu.vn>
Date: Wed, 3 Dec 2025 11:53:09 +0700
Subject: [PATCH] create login and sign up, assign scheduled event successfully

---
 backend/backend/settings.py               | 15 +++++++++++-
 backend/backend/urls.py                   | 16 ++++++++++++-
 backend/events/__init__.py                |  0
 backend/events/admin.py                   |  4 ++++
 backend/events/apps.py                    |  6 +++++
 backend/events/migrations/0001_initial.py | 28 +++++++++++++++++++++++
 backend/events/migrations/__init__.py     |  0
 backend/events/models.py                  | 12 ++++++++++
 backend/events/serializers.py             |  7 ++++++
 backend/events/tests.py                   |  3 +++
 backend/events/urls.py                    |  6 +++++
 backend/events/views.py                   | 10 ++++++++
 backend/users/serializers.py              | 21 +++++++++++++++++
 backend/users/urls.py                     |  7 ++++++
 backend/users/views.py                    | 21 +++++++++++++++--
 15 files changed, 152 insertions(+), 4 deletions(-)
 create mode 100644 backend/events/__init__.py
 create mode 100644 backend/events/admin.py
 create mode 100644 backend/events/apps.py
 create mode 100644 backend/events/migrations/0001_initial.py
 create mode 100644 backend/events/migrations/__init__.py
 create mode 100644 backend/events/models.py
 create mode 100644 backend/events/serializers.py
 create mode 100644 backend/events/tests.py
 create mode 100644 backend/events/urls.py
 create mode 100644 backend/events/views.py
 create mode 100644 backend/users/serializers.py
 create mode 100644 backend/users/urls.py

diff --git a/backend/backend/settings.py b/backend/backend/settings.py
index ddf71b9..e39c15b 100644
--- a/backend/backend/settings.py
+++ b/backend/backend/settings.py
@@ -37,8 +37,21 @@ INSTALLED_APPS = [
     'django.contrib.sessions',
     'django.contrib.messages',
     'django.contrib.staticfiles',
+    'users',
+    'events',
+    'rest_framework',
+    'rest_framework.authtoken',
 ]
 
+REST_FRAMEWORK = {
+    'DEFAULT_AUTHENTICATION_CLASSES': [
+        'rest_framework.authentication.TokenAuthentication',
+    ],
+    'DEFAULT_PERMISSION_CLASSES': [
+        'rest_framework.permissions.IsAuthenticated',
+    ]
+}
+
 MIDDLEWARE = [
     'django.middleware.security.SecurityMiddleware',
     'django.contrib.sessions.middleware.SessionMiddleware',
@@ -119,4 +132,4 @@ STATIC_URL = 'static/'
 # Default primary key field type
 # https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field
 
-DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
+DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
\ No newline at end of file
diff --git a/backend/backend/urls.py b/backend/backend/urls.py
index c677216..29460fb 100644
--- a/backend/backend/urls.py
+++ b/backend/backend/urls.py
@@ -15,8 +15,22 @@ Including another URLconf
     2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
 """
 from django.contrib import admin
-from django.urls import path
+from django.urls import path, include
+from django.http import JsonResponse
+
+def root_view(request):
+    return JsonResponse({
+        "message": "Welcome to Academic Calendar API",
+        "available_endpoints": [
+            "/api/users/signup/",
+            "/api/users/login/",
+            "/api/events/my-events/"
+        ]
+    })
 
 urlpatterns = [
+    path('', root_view),
     path('admin/', admin.site.urls),
+    path('api/users/', include('users.urls')),
+    path('api/events/', include('events.urls')),
 ]
diff --git a/backend/events/__init__.py b/backend/events/__init__.py
new file mode 100644
index 0000000..e69de29
diff --git a/backend/events/admin.py b/backend/events/admin.py
new file mode 100644
index 0000000..d6c80cc
--- /dev/null
+++ b/backend/events/admin.py
@@ -0,0 +1,4 @@
+from django.contrib import admin
+from .models import Event
+
+admin.site.register(Event)
diff --git a/backend/events/apps.py b/backend/events/apps.py
new file mode 100644
index 0000000..20f48f2
--- /dev/null
+++ b/backend/events/apps.py
@@ -0,0 +1,6 @@
+from django.apps import AppConfig
+
+
+class EventsConfig(AppConfig):
+    default_auto_field = 'django.db.models.BigAutoField'
+    name = 'events'
diff --git a/backend/events/migrations/0001_initial.py b/backend/events/migrations/0001_initial.py
new file mode 100644
index 0000000..2b1d1a8
--- /dev/null
+++ b/backend/events/migrations/0001_initial.py
@@ -0,0 +1,28 @@
+# Generated by Django 5.2.9 on 2025-12-03 04:45
+
+import django.db.models.deletion
+from django.conf import settings
+from django.db import migrations, models
+
+
+class Migration(migrations.Migration):
+
+    initial = True
+
+    dependencies = [
+        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
+    ]
+
+    operations = [
+        migrations.CreateModel(
+            name='Event',
+            fields=[
+                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
+                ('title', models.CharField(max_length=200)),
+                ('description', models.TextField(blank=True)),
+                ('start_time', models.DateTimeField()),
+                ('end_time', models.DateTimeField()),
+                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='events', to=settings.AUTH_USER_MODEL)),
+            ],
+        ),
+    ]
diff --git a/backend/events/migrations/__init__.py b/backend/events/migrations/__init__.py
new file mode 100644
index 0000000..e69de29
diff --git a/backend/events/models.py b/backend/events/models.py
new file mode 100644
index 0000000..e41f9b6
--- /dev/null
+++ b/backend/events/models.py
@@ -0,0 +1,12 @@
+from django.db import models
+from django.contrib.auth.models import User
+
+class Event(models.Model):
+    title = models.CharField(max_length=200)
+    description = models.TextField(blank=True)
+    start_time = models.DateTimeField()
+    end_time = models.DateTimeField()
+    assigned_to = models.ForeignKey(User, on_delete=models.CASCADE, related_name='events', null=True, blank=True)
+
+    def __str__(self):
+        return self.title
diff --git a/backend/events/serializers.py b/backend/events/serializers.py
new file mode 100644
index 0000000..cedac13
--- /dev/null
+++ b/backend/events/serializers.py
@@ -0,0 +1,7 @@
+from rest_framework import serializers
+from .models import Event
+
+class EventSerializer(serializers.ModelSerializer):
+    class Meta:
+        model = Event
+        fields = ['id', 'title', 'description', 'start_time', 'end_time']
diff --git a/backend/events/tests.py b/backend/events/tests.py
new file mode 100644
index 0000000..7ce503c
--- /dev/null
+++ b/backend/events/tests.py
@@ -0,0 +1,3 @@
+from django.test import TestCase
+
+# Create your tests here.
diff --git a/backend/events/urls.py b/backend/events/urls.py
new file mode 100644
index 0000000..a97502e
--- /dev/null
+++ b/backend/events/urls.py
@@ -0,0 +1,6 @@
+from django.urls import path
+from .views import UserEventsView
+
+urlpatterns = [
+    path('my-events/', UserEventsView.as_view(), name='user-events'),
+]
diff --git a/backend/events/views.py b/backend/events/views.py
new file mode 100644
index 0000000..3b95387
--- /dev/null
+++ b/backend/events/views.py
@@ -0,0 +1,10 @@
+from rest_framework import generics, permissions
+from .models import Event
+from .serializers import EventSerializer
+
+class UserEventsView(generics.ListAPIView):
+    serializer_class = EventSerializer
+    permission_classes = [permissions.IsAuthenticated]
+
+    def get_queryset(self):
+        return Event.objects.filter(assigned_to=self.request.user)
diff --git a/backend/users/serializers.py b/backend/users/serializers.py
new file mode 100644
index 0000000..c086d72
--- /dev/null
+++ b/backend/users/serializers.py
@@ -0,0 +1,21 @@
+from django.contrib.auth.models import User
+from rest_framework import serializers
+
+class SignupSerializer(serializers.ModelSerializer):
+    class Meta:
+        model = User
+        fields = ['username', 'email', 'password']
+        extra_kwargs = {'password': {'write_only': True}}
+
+    def create(self, validated_data):
+        user = User.objects.create_user(
+            username=validated_data['username'],
+            email=validated_data.get('email', ''),
+            password=validated_data['password']
+        )
+        return user
+
+class UserSerializer(serializers.ModelSerializer):
+    class Meta:
+        model = User
+        fields = ['id', 'username', 'email']
diff --git a/backend/users/urls.py b/backend/users/urls.py
new file mode 100644
index 0000000..cddad7e
--- /dev/null
+++ b/backend/users/urls.py
@@ -0,0 +1,7 @@
+from django.urls import path
+from .views import SignupView, LoginView
+
+urlpatterns = [
+    path('signup/', SignupView.as_view(), name='signup'),
+    path('login/', LoginView.as_view(), name='login'),
+]
diff --git a/backend/users/views.py b/backend/users/views.py
index 91ea44a..9793e51 100644
--- a/backend/users/views.py
+++ b/backend/users/views.py
@@ -1,3 +1,20 @@
-from django.shortcuts import render
+from rest_framework.views import APIView
+from rest_framework.response import Response
+from rest_framework import status
+from rest_framework.authtoken.models import Token
+from rest_framework.authtoken.views import ObtainAuthToken
+from .serializers import SignupSerializer
 
-# Create your views here.
+# Signup endpoint
+class SignupView(APIView):
+    def post(self, request):
+        serializer = SignupSerializer(data=request.data)
+        if serializer.is_valid():
+            user = serializer.save()
+            token, _ = Token.objects.get_or_create(user=user)
+            return Response({"token": token.key}, status=status.HTTP_201_CREATED)
+        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
+
+# Login endpoint (returns token)
+class LoginView(ObtainAuthToken):
+    pass
-- 
2.51.0.windows.1

